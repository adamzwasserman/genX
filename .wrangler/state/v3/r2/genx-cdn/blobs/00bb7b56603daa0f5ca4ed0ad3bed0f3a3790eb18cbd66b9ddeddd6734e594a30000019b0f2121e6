var genx=(()=>{var e,t,s=Object.getOwnPropertyNames;return(e={"src/bootloader.js"(e,t){!function(){"use strict";const e={fx:"/fmtx.min.js",ax:"/accx.min.js",bx:"/bindx.min.js",dx:"/dragx.min.js",lx:"/loadx.min.js",tx:"/tablex.min.js",nx:"/navx.min.js"},s="undefined"!=typeof window&&window.genxConfig?.modulePaths?{...e,...window.genxConfig.modulePaths}:e,n="undefined"!=typeof window&&window.genxCommon&&window.genxCommon.notation&&window.genxCommon.notation.CLASS_PREFIX_MAP?window.genxCommon.notation.CLASS_PREFIX_MAP:{fmt:"fx",acc:"ax",bind:"bx",drag:"dx",load:"lx",table:"tx",nav:"nx"},o=(Object.fromEntries(Object.entries(n).map(([e,t])=>[t,e])),window.genxConfig?.cdn||"https://cdn.genx.software/v1"),a=new Set,r=new Set,c={},i={verbose:"/parsers/genx-parser-verbose.js",colon:"/parsers/genx-parser-colon.js",json:"/parsers/genx-parser-json.js",class:"/parsers/genx-parser-class.js"},l="undefined"!=typeof window&&window.genxConfig?.parserPaths?{...i,...window.genxConfig.parserPaths}:i,d={},m=new Set,p=new WeakMap,f={bootstrap:{total:0,phases:{scan:0,detectStyles:0,loadParsers:0,parseElements:0,initModules:0,setupObserver:0}},scans:[],parses:[],cacheHits:0,cacheMisses:0,elementCount:0,parsedCount:0},h={scan1000:5,parse1000:100,moduleInit:105,cacheLookup:.001},u=async e=>{if(!e||0===e.length)return{};const t=[],s={};for(const n of e){if(d[n]){s[n]=d[n];continue}if(m.has(n)){t.push(new Promise(e=>{const t=setInterval(()=>{d[n]&&(clearInterval(t),s[n]=d[n],e())},10)}));continue}m.add(n);const e=window.genxConfig?.cdn||"",o=l[n],a=e?`${e}${o}`:o,r=import(a).then(e=>{d[n]=e,m.delete(n),s[n]=e}).catch(e=>{m.delete(n),console.error(`Failed to load ${n} parser from ${a}:`,e),s[n]=null});t.push(r)}return await Promise.all(t),s},g=()=>[...Object.keys(s).map(e=>`[${e}-]`),...Object.keys(n).map(e=>`[class*="${e}-"]`)].join(","),w=e=>{for(const t of Object.keys(s)){const s=e.attributes;for(let e=0;e<s.length;e++)if(s[e].name.startsWith(t+"-"))return t}const t=e.classList;if(t&&t.length>0)for(let e=0;e<t.length;e++){const s=t[e];for(const[e,t]of Object.entries(n))if(s.startsWith(e+"-"))return t}return null},x=(e=document)=>{const t=performance.now(),s=g(),n=Array.from(e.querySelectorAll(s)),o=new Set;for(const e of n){const t=w(e);t&&o.add(t)}const a=performance.now()-t;f.scans.push({elementCount:n.length,duration:a,timestamp:Date.now()});const r=a/n.length*1e3;return r>h.scan1000&&n.length>100&&window.genxConfig?.performance?.warnings&&console.warn(`⚠️ genX Performance: Scan time ${a.toFixed(2)}ms for ${n.length} elements (normalized: ${r.toFixed(2)}ms/1000 elements, target: <${h.scan1000}ms/1000)`),{needed:o,elements:n}},y=e=>{const t=new Set;if(!e||0===e.length)return[];for(const o of e){for(const e of Object.keys(s)){const s=o.attributes;for(let n=0;n<s.length;n++){const o=s[n].name,a=s[n].value;o.startsWith(e+"-")&&(t.add("verbose"),a&&a.includes(":")&&t.add("colon"),o.endsWith("-opts")&&t.add("json"))}}const e=o.classList;if(e&&e.length>0)for(let s=0;s<e.length;s++){const o=e[s];for(const e of Object.keys(n))if(o.startsWith(e+"-")){t.add("class");break}if(t.has("class"))break}if(4===t.size)break}return Array.from(t).sort()},b=(e,t)=>{const s=performance.now();let n=0,o=0;for(const s of e){if(p.has(s)){o++,f.cacheHits++;continue}f.cacheMisses++;const e=w(s);if(!e)continue;let a={};t.json&&t.json.parse&&(a=t.json.parse(s,e,a)),t.colon&&t.colon.parse&&(a=t.colon.parse(s,e,a)),t.verbose&&t.verbose.parse&&(a=t.verbose.parse(s,e,a)),t.class&&t.class.parse&&(a=t.class.parse(s,e,a)),a&&Object.keys(a).length>0&&(p.set(s,a),n++)}const a=performance.now()-s;f.parses.push({elementCount:e.length,parsedCount:n,cacheHits:o,duration:a,timestamp:Date.now()}),f.elementCount+=e.length,f.parsedCount+=n;const r=a/e.length*1e3;return r>h.parse1000&&e.length>100&&window.genxConfig?.performance?.warnings&&console.warn(`⚠️ genX Performance: Parse time ${a.toFixed(2)}ms for ${e.length} elements (normalized: ${r.toFixed(2)}ms/1000 elements, target: <${h.parse1000}ms/1000)`),window.genxConfig?.performance?.logging&&console.log(`genX: Parsed ${n} elements (${o} cache hits) in ${a.toFixed(2)}ms`),n},C=async(e=document)=>{let t=[];if(Array.isArray(e))t=e.filter(e=>e&&e.nodeType===Node.ELEMENT_NODE);else{if(!e||e.nodeType!==Node.ELEMENT_NODE&&e!==document)return 0;{const s=g();if(!s)return 0;if(e===document)t=Array.from(document.querySelectorAll(s));else{const n=e;try{n.matches&&n.matches(s)&&t.push(n)}catch(e){}t=t.concat(Array.from(n.querySelectorAll(s)))}}}if(0===t.length)return 0;const s=y(t),n=await u(s);return b(t,n)},$=async e=>{if(a.has(e))return c[e];if(r.has(e))return new Promise(t=>{const s=setInterval(()=>{a.has(e)&&(clearInterval(s),t(c[e]))},10)});r.add(e);try{const t=s[e],n=t.startsWith("http")||t.startsWith("/")?t:o+t,i=document.createElement("script");return i.src=n,i.async=!0,window.genxConfig?.sri?.[e]&&(i.integrity=window.genxConfig.sri[e],i.crossOrigin="anonymous"),await new Promise((t,s)=>{i.onload=()=>{const n=e+"XFactory";window[n]?(c[e]=window[n],a.add(e),r.delete(e),t()):s(new Error(`Module ${e} did not expose factory ${n}`))},i.onerror=()=>{r.delete(e),s(new Error(`Failed to load module ${e} from ${n}`))},document.head.appendChild(i)}),c[e]}catch(t){throw r.delete(e),console.error(`genX Bootloader: Failed to load ${e}`,t),t}},E=async(e,t={})=>{const s=await $(e);return s&&s.init?s.init(t):null},j=async()=>{const{needed:e}=x(),t={};for(const s of e)try{const e=window.genxConfig?.modules?.[s]||{};t[s]=await E(s,e)}catch(e){console.error(`genX: Failed to initialize ${s}`,e),t[s]=null}return t},v=()=>{requestAnimationFrame(async()=>{const e=performance.now(),t={phases:{},elements:{total:0,parsed:0},styles:[],parsers:[],modules:[]};try{const s=performance.now(),{needed:n,elements:o}=x();t.phases.scan=performance.now()-s,t.elements.total=o.length;const r=performance.now(),c=y(o);t.phases.detectStyles=performance.now()-r,t.styles=c;const i=performance.now(),l=await u(c);t.phases.loadParsers=performance.now()-i,t.parsers=Object.keys(l);const d=performance.now(),m=b(o,l);t.phases.parseElements=performance.now()-d,t.elements.parsed=m;const p=performance.now();await j(),t.phases.initModules=performance.now()-p,t.modules=Array.from(a);const w=performance.now();if(!1!==window.genxConfig?.observe){let e=new Set,t=null;const s=s=>{for(const t of s)"childList"===t.type&&t.addedNodes.length>0&&t.addedNodes.forEach(t=>{t&&t.nodeType===Node.ELEMENT_NODE&&e.add(t)}),"attributes"===t.type&&t.target&&t.target.nodeType===Node.ELEMENT_NODE&&e.add(t.target);clearTimeout(t),t=setTimeout(async()=>{try{const t=Array.from(e||[]);e=new Set;const s=g(),n=new Set;for(const e of t){try{s&&e.matches&&e.matches(s)&&n.add(e)}catch(e){}if(s){const t=Array.from(e.querySelectorAll(s));for(const e of t)n.add(e)}}await C(n.size?Array.from(n):document);const{needed:o}=x();for(const e of o)a.has(e)||E(e)}catch(e){console.error("genX: incremental rescan failed",e)}},100)};window.domxBridge?window.domxBridge.subscribe("bootloader",s,{childList:!0}):new MutationObserver(s).observe(document.body,{childList:!0,subtree:!0})}t.phases.setupObserver=performance.now()-w;const $=performance.now()-e;t.total=$,f.bootstrap.total=$,f.bootstrap.phases=t.phases;const v=f.cacheHits+f.cacheMisses,P=v>0?f.cacheHits/v*100:0;$>h.moduleInit&&window.genxConfig?.performance?.warnings&&console.warn(`⚠️ genX Performance: Bootstrap time ${$.toFixed(2)}ms exceeds target of ${h.moduleInit}ms`),window.genxConfig?.performance?.logging&&console.log("genX Bootstrap Complete:",{total:`${$.toFixed(2)}ms`,phases:{scan:`${t.phases.scan.toFixed(2)}ms`,detectStyles:`${t.phases.detectStyles.toFixed(2)}ms`,loadParsers:`${t.phases.loadParsers.toFixed(2)}ms`,parseElements:`${t.phases.parseElements.toFixed(2)}ms`,initModules:`${t.phases.initModules.toFixed(2)}ms`,setupObserver:`${t.phases.setupObserver.toFixed(2)}ms`},elements:t.elements,styles:t.styles,modules:t.modules,cache:{hits:f.cacheHits,misses:f.cacheMisses,hitRate:`${P.toFixed(1)}%`}}),window.dispatchEvent(new CustomEvent("genx:ready",{detail:{loaded:t.modules,elements:t.elements,styles:t.styles,parsers:t.parsers,timing:{total:$,phases:t.phases},performance:{bootstrap:f.bootstrap,scans:f.scans,parses:f.parses,cache:{hits:f.cacheHits,misses:f.cacheMisses,hitRate:P},targets:h,meetsTargets:{bootstrap:$<=h.moduleInit,scan:t.phases.scan<=h.scan1000,parse:t.phases.parseElements<=h.parse1000}}}}))}catch(e){console.error("genX Bootloader: Initialization failed",e)}})},P=()=>{const e=f.cacheHits+f.cacheMisses,t=e>0?f.cacheHits/e*100:0;return{bootstrap:f.bootstrap,scans:f.scans,parses:f.parses,cache:{hits:f.cacheHits,misses:f.cacheMisses,total:e,hitRate:t},elements:{total:f.elementCount,parsed:f.parsedCount},targets:h}},F={version:"1.0.0",scan:x,load:$,init:E,initAll:j,loaded:()=>Array.from(a),isLoaded:e=>a.has(e),getFactory:e=>c[e],detectNotationStyles:y,loadParsers:u,getConfig:e=>e&&e.attributes&&p.has(e)?p.get(e):null,parseAllElements:b,rescan:C,getPerformanceMetrics:P,validatePerformance:()=>{const e=P(),t={passed:!0,failures:[]};e.bootstrap.total>h.moduleInit&&(t.passed=!1,t.failures.push({metric:"bootstrap.total",actual:e.bootstrap.total,target:h.moduleInit,message:`Bootstrap time ${e.bootstrap.total.toFixed(2)}ms exceeds target ${h.moduleInit}ms`}));for(const s of e.scans){const e=s.duration/s.elementCount*1e3;e>h.scan1000&&s.elementCount>100&&(t.passed=!1,t.failures.push({metric:"scan.normalized",actual:e,target:h.scan1000,message:`Scan time ${e.toFixed(2)}ms/1000 exceeds target ${h.scan1000}ms/1000`}))}for(const s of e.parses){const e=s.duration/s.elementCount*1e3;e>h.parse1000&&s.elementCount>100&&(t.passed=!1,t.failures.push({metric:"parse.normalized",actual:e,target:h.parse1000,message:`Parse time ${e.toFixed(2)}ms/1000 exceeds target ${h.parse1000}ms/1000`}))}return e.cache.total>0&&e.cache.hitRate<95&&(t.passed=!1,t.failures.push({metric:"cache.hitRate",actual:e.cache.hitRate,target:95,message:`Cache hit rate ${e.cache.hitRate.toFixed(1)}% below target 95%`})),t},resetPerformanceMetrics:()=>{f.bootstrap={total:0,phases:{scan:0,detectStyles:0,loadParsers:0,parseElements:0,initModules:0,setupObserver:0}},f.scans=[],f.parses=[],f.cacheHits=0,f.cacheMisses=0,f.elementCount=0,f.parsedCount=0},_buildUnifiedSelector:g,_detectPrefix:w};window.genx=F,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",v):v(),void 0!==t&&t.exports&&(t.exports=F)}()}},function(){return t||(0,e[s(e)[0]])((t={exports:{}}).exports,t),t.exports})()})();